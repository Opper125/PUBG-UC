<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Downloader Bot - Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pyidaungsu', 'Noto Sans Myanmar', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .status {
            display: inline-block;
            padding: 8px 20px;
            background: #4CAF50;
            color: white;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .status.offline {
            background: #f44336;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .stat-box {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .stat-label {
            font-weight: bold;
            color: #666;
        }

        .stat-value {
            font-size: 1.5em;
            color: #667eea;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #da190b;
        }

        .file-upload {
            border: 2px dashed #667eea;
            padding: 30px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            background: #f5f5f5;
        }

        .file-upload input {
            display: none;
        }

        .preview {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }

        .preview img,
        .preview video {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .logs {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
            font-size: 0.9em;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-left: 3px solid #00ff00;
            padding-left: 10px;
        }

        .log-entry.error {
            border-left-color: #ff0000;
            color: #ff6b6b;
        }

        .log-entry.warning {
            border-left-color: #ffaa00;
            color: #ffd93d;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #667eea;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üé¨ Video Downloader Bot</h1>
            <p style="margin: 10px 0; color: #666;">Telegram Bot Admin Panel</p>
            <span class="status" id="botStatus">‚óè Bot ·Äï·Ä≠·Äê·Ä∫·Äî·Ä±·Äû·Ää·Ä∫</span>
        </div>

        <!-- Alert Messages -->
        <div class="alert" id="alertBox"></div>

        <!-- Dashboard Stats -->
        <div class="dashboard">
            <div class="card">
                <h2>üìä ·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏·Äá·Äö·Ä¨·Ä∏</h2>
                <div class="stat-box">
                    <span class="stat-label">·ÄÖ·ÄØ·ÄÖ·ÄØ·Äï·Ä±·Ä´·ÄÑ·Ä∫·Ä∏ Users</span>
                    <span class="stat-value" id="totalUsers">0</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">·Äö·Äî·Ä±·Ä∑ Downloads</span>
                    <span class="stat-value" id="todayDownloads">0</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">·ÄÖ·ÄØ·ÄÖ·ÄØ·Äï·Ä±·Ä´·ÄÑ·Ä∫·Ä∏ Downloads</span>
                    <span class="stat-value" id="totalDownloads">0</span>
                </div>
            </div>

            <div class="card">
                <h2>‚öôÔ∏è Bot ·ÄÜ·ÄÄ·Ä∫·Äê·ÄÑ·Ä∫·Äô·Äª·Ä¨·Ä∏</h2>
                <div class="form-group">
                    <label>Bot Token</label>
                    <input type="text" id="botToken" value="7821519539:AAFmikR4MBeLKRLTYD3nqeTUrSdc7RqJQA8" readonly>
                </div>
                <button class="btn btn-primary" onclick="startBot()">üöÄ Bot ·ÄÖ·Äê·ÄÑ·Ä∫·Äõ·Äî·Ä∫</button>
                <button class="btn btn-danger" onclick="stopBot()">‚èπÔ∏è Bot ·Äõ·Äï·Ä∫·Äõ·Äî·Ä∫</button>
            </div>
        </div>

        <!-- Broadcast Section -->
        <div class="card">
            <h2>üì¢ ·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·Äû·Ä∞·Äô·Äª·Ä¨·Ä∏·Äë·Ä∂ ·Ä°·Äû·Ä≠·Äï·Ä±·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫·Äï·Ä≠·ÄØ·Ä∑·Äõ·Äî·Ä∫</h2>
            <div class="form-group">
                <label>·Äô·ÄÄ·Ä∫·ÄÜ·Ä±·Ä∑·ÄÅ·Äª·Ä∫</label>
                <textarea id="broadcastMessage" placeholder="·Äû·ÄÑ·Ä∫·Äï·Ä≠·ÄØ·Ä∑·Äú·Ä≠·ÄØ·Äû·Ä±·Ä¨ ·Äô·ÄÄ·Ä∫·ÄÜ·Ä±·Ä∑·ÄÅ·Äª·Ä∫·ÄÄ·Ä≠·ÄØ ·Äõ·Ä≠·ÄØ·ÄÄ·Ä∫·Äë·Ää·Ä∑·Ä∫·Äï·Ä´..."></textarea>
            </div>
            
            <div class="form-group">
                <label>·Äï·ÄØ·Ä∂/·Äó·ÄÆ·Äí·ÄÆ·Äö·Ä≠·ÄØ ·Äë·Ää·Ä∑·Ä∫·Äõ·Äî·Ä∫ (Optional)</label>
                <div class="file-upload" onclick="document.getElementById('broadcastFiles').click()">
                    <p>üìÅ ·Äñ·Ä≠·ÄØ·ÄÑ·Ä∫·Äô·Äª·Ä¨·Ä∏·Äõ·ÄΩ·Ä±·Ä∏·ÄÅ·Äª·Äö·Ä∫·Äõ·Äî·Ä∫ ·Äî·Äæ·Ä≠·Äï·Ä∫·Äï·Ä´</p>
                    <p style="font-size: 0.9em; color: #666;">·Äï·ÄØ·Ä∂ (PNG, JPG) ·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫ ·Äó·ÄÆ·Äí·ÄÆ·Äö·Ä≠·ÄØ (MP4)</p>
                    <input type="file" id="broadcastFiles" multiple accept="image/*,video/*" onchange="previewFiles()">
                </div>
                <div class="preview" id="filePreview"></div>
            </div>

            <div class="loading" id="broadcastLoading">
                <div class="spinner"></div>
                <p>·Äï·Ä≠·ÄØ·Ä∑·Äî·Ä±·Äû·Ää·Ä∫...</p>
            </div>

            <button class="btn btn-success" onclick="sendBroadcast()">üì§ ·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏·Äë·Ä∂ ·Äï·Ä≠·ÄØ·Ä∑·Äõ·Äî·Ä∫</button>
        </div>

        <!-- Channel/Group Settings -->
        <div class="card">
            <h2>üîó Channel & Group Settings</h2>
            <div class="settings-grid">
                <div class="form-group">
                    <label>Channel Link</label>
                    <input type="text" id="channelLink" value="https://t.me/+akSU2_DCpW5iMzll" readonly>
                </div>
                <div class="form-group">
                    <label>Channel ID</label>
                    <input type="text" id="channelId" value="-1003011981359" readonly>
                </div>
                <div class="form-group">
                    <label>Group Link</label>
                    <input type="text" id="groupLink" value="https://t.me/+okfdHYdJXjcwNGFl" readonly>
                </div>
                <div class="form-group">
                    <label>Group ID</label>
                    <input type="text" id="groupId" value="-1003151936245" readonly>
                </div>
            </div>
        </div>

        <!-- Bot Logs -->
        <div class="card">
            <h2>üìù Bot Logs</h2>
            <div class="logs" id="botLogs">
                <div class="log-entry">System initialized...</div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // Configuration
        const CONFIG = {
            BOT_TOKEN: '7821519539:AAFmikR4MBeLKRLTYD3nqeTUrSdc7RqJQA8',
            CHANNEL_ID: '-1003011981359',
            GROUP_ID: '-1003151936245',
            CHANNEL_LINK: 'https://t.me/+akSU2_DCpW5iMzll',
            GROUP_LINK: 'https://t.me/+okfdHYdJXjcwNGFl',
            ADMIN_USERNAME: '@OPPER101'
        };

        // Local Storage Keys
        const STORAGE_KEYS = {
            USERS: 'bot_users',
            DOWNLOADS: 'bot_downloads',
            STATS: 'bot_stats'
        };

        // Initialize Bot
        let botRunning = false;
        let updateOffset = 0;

        // Welcome Message
        const WELCOME_MESSAGE = `ü§ù ·Äô·ÄÇ·Ä∫·Äú·Ä¨·Äï·Ä´·ÄÅ·ÄÑ·Ä∫·Äó·Äª·Ä¨ Bot ·ÄÄ·Ä≠·ÄØ ·ÄÖ·Äê·ÄÑ·Ä∫·Äô·Ä∞·Ä∑·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ ·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äê·ÄÑ·Ä∫·Äï·Ä´·Äê·Äö·Ä∫

Bot ·Äê·ÄΩ·ÄÑ·Ä∫ Video Link ·Äï·Ä≠·ÄØ·Ä∑·Äï·ÄÆ·Ä∏ Video ·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ Quality ·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏ Download ·ÄÜ·ÄΩ·Ä≤·Äï·Ä´

üìå Supported Platforms:
‚Ä¢ YouTube (Videos & Shorts)
‚Ä¢ Facebook (Videos)
‚Ä¢ TikTok (Videos)
‚Ä¢ Instagram (Reels & Videos)

üí° ·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·Äî·Ää·Ä∫·Ä∏:
1. Video link ·ÄÄ·Ä≠·ÄØ copy ·Äú·ÄØ·Äï·Ä∫·Äï·Ä´
2. Bot ·Äë·Ä≤·Äô·Äæ·Ä¨ paste ·Äú·ÄØ·Äï·Ä∫·Äï·Ä´
3. Quality ·Äõ·ÄΩ·Ä±·Ä∏·Äï·Ä´
4. Download ·ÄÜ·ÄΩ·Ä≤·Äï·Ä´

üéØ Let's start!`;

        // Success Download Message
        const DOWNLOAD_SUCCESS_MESSAGE = `\n\n‚úÖ ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·ÄÖ·ÄΩ·Ä¨ Download ·Äï·ÄÆ·Ä∏·ÄÜ·ÄØ·Ä∂·Ä∏·ÄÅ·Ä≤·Ä∑·Äï·ÄÆ·Ä∏ Feedback ·Äô·Äª·Ä¨·Ä∏·Äï·Ä±·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Äï·Ä´·ÄÄ Telegram Bot Owner ·Äñ·Äº·ÄÖ·Ä∫·Äê·Ä≤·Ä∑ ${CONFIG.ADMIN_USERNAME} ·ÄÄ·Ä≠·ÄØ ·Äê·Ä≠·ÄØ·ÄÄ·Ä∫·Äõ·Ä≠·ÄØ·ÄÄ·Ä∫ Feedback ·Äï·Ä≠·ÄØ·Ä∑·Äï·Ä±·Ä∏·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äû·Ää·Ä∫`;

        // Initialize Stats
        function initStats() {
            if (!localStorage.getItem(STORAGE_KEYS.STATS)) {
                localStorage.setItem(STORAGE_KEYS.STATS, JSON.stringify({
                    totalUsers: 0,
                    totalDownloads: 0,
                    todayDownloads: 0,
                    lastReset: new Date().toDateString()
                }));
            }
            updateDashboard();
        }

        // Update Dashboard
        function updateDashboard() {
            const stats = JSON.parse(localStorage.getItem(STORAGE_KEYS.STATS) || '{}');
            
            // Reset daily stats if new day
            if (stats.lastReset !== new Date().toDateString()) {
                stats.todayDownloads = 0;
                stats.lastReset = new Date().toDateString();
                localStorage.setItem(STORAGE_KEYS.STATS, JSON.stringify(stats));
            }

            document.getElementById('totalUsers').textContent = stats.totalUsers || 0;
            document.getElementById('todayDownloads').textContent = stats.todayDownloads || 0;
            document.getElementById('totalDownloads').textContent = stats.totalDownloads || 0;
        }

        // Add User
        function addUser(userId, username, firstName) {
            let users = JSON.parse(localStorage.getItem(STORAGE_KEYS.USERS) || '{}');
            
            if (!users[userId]) {
                users[userId] = {
                    id: userId,
                    username: username,
                    firstName: firstName,
                    joinedAt: new Date().toISOString(),
                    hasJoinedChannel: false,
                    hasJoinedGroup: false,
                    downloadCount: 0
                };

                localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));

                // Update stats
                const stats = JSON.parse(localStorage.getItem(STORAGE_KEYS.STATS));
                stats.totalUsers++;
                localStorage.setItem(STORAGE_KEYS.STATS, JSON.stringify(stats));
                updateDashboard();
            }

            return users[userId];
        }

        // Check Membership
        async function checkMembership(userId, chatId) {
            try {
                const response = await axios.get(`https://api.telegram.org/bot${CONFIG.BOT_TOKEN}/getChatMember`, {
                    params: {
                        chat_id: chatId,
                        user_id: userId
                    }
                });

                const status = response.data.result.status;
                return ['creator', 'administrator', 'member'].includes(status);
            } catch (error) {
                addLog('Membership check error: ' + error.message, 'error');
                return false;
            }
        }

        // Send Message
        async function sendMessage(chatId, text, options = {}) {
            try {
                const response = await axios.post(`https://api.telegram.org/bot${CONFIG.BOT_TOKEN}/sendMessage`, {
                    chat_id: chatId,
                    text: text,
                    parse_mode: 'HTML',
                    ...options
                });
                return response.data.result;
            } catch (error) {
                addLog('Send message error: ' + error.message, 'error');
                throw error;
            }
        }

        // Send Photo
        async function sendPhoto(chatId, photo, caption = '') {
            try {
                const formData = new FormData();
                formData.append('chat_id', chatId);
                formData.append('photo', photo);
                if (caption) formData.append('caption', caption);

                const response = await axios.post(`https://api.telegram.org/bot${CONFIG.BOT_TOKEN}/sendPhoto`, formData);
                return response.data.result;
            } catch (error) {
                addLog('Send photo error: ' + error.message, 'error');
                throw error;
            }
        }

        // Send Video
        async function sendVideo(chatId, video, caption = '') {
            try {
                const formData = new FormData();
                formData.append('chat_id', chatId);
                formData.append('video', video);
                if (caption) formData.append('caption', caption);

                const response = await axios.post(`https://api.telegram.org/bot${CONFIG.BOT_TOKEN}/sendVideo`, formData);
                return response.data.result;
            } catch (error) {
                addLog('Send video error: ' + error.message, 'error');
                throw error;
            }
        }

        // Detect Platform from URL
        function detectPlatform(url) {
            if (url.includes('youtube.com') || url.includes('youtu.be')) return 'youtube';
            if (url.includes('facebook.com') || url.includes('fb.watch')) return 'facebook';
            if (url.includes('tiktok.com')) return 'tiktok';
            if (url.includes('instagram.com')) return 'instagram';
            return null;
        }

        // Process Video URL (This needs actual API integration)
        async function processVideoUrl(url, chatId, userId) {
            const platform = detectPlatform(url);
            
            if (!platform) {
                await sendMessage(chatId, '‚ùå ·Äï·Ä∂·Ä∑·Äï·Ä≠·ÄØ·Ä∏·Äô·Äë·Ä¨·Ä∏·Äû·Ä±·Ä¨ link ·Äñ·Äº·ÄÖ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫·Åã YouTube, Facebook, TikTok, Instagram links ·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ·Äû·Ä¨ ·Äï·Ä∂·Ä∑·Äï·Ä≠·ÄØ·Ä∏·Äï·Ä´·Äû·Ää·Ä∫·Åã');
                return;
            }

            await sendMessage(chatId, `üîç ${platform.toUpperCase()} link ·ÄÄ·Ä≠·ÄØ ·ÄÖ·Ä≠·ÄÖ·ÄÖ·Ä∫·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫...`);

            // TODO: Integrate with actual video download API
            // For now, showing demo response
            const keyboard = {
                inline_keyboard: [
                    [
                        { text: 'üìπ HD Quality (1080p)', callback_data: `download_hd_${userId}` },
                        { text: 'üìπ SD Quality (720p)', callback_data: `download_sd_${userId}` }
                    ],
                    [
                        { text: 'üéµ MP3 Audio', callback_data: `download_mp3_${userId}` }
                    ]
                ]
            };

            await sendMessage(chatId, 
                `‚úÖ Video ·Äõ·Äæ·Ä¨·Äê·ÄΩ·Ä±·Ä∑·Äï·Ä´·Äï·ÄÆ!\n\n` +
                `üì± Platform: ${platform.toUpperCase()}\n` +
                `üé¨ ·Äû·ÄÑ·Ä∫·Äú·Ä≠·ÄØ·ÄÅ·Äª·ÄÑ·Ä∫·Äû·Ä±·Ä¨ Quality ·ÄÄ·Ä≠·ÄØ ·Äõ·ÄΩ·Ä±·Ä∏·Äï·Ä´:`,
                { reply_markup: keyboard }
            );

            // Update download stats
            const stats = JSON.parse(localStorage.getItem(STORAGE_KEYS.STATS));
            stats.totalDownloads++;
            stats.todayDownloads++;
            localStorage.setItem(STORAGE_KEYS.STATS, JSON.stringify(stats));
            updateDashboard();
        }

        // Handle Updates
        async function handleUpdate(update) {
            try {
                if (update.message) {
                    const message = update.message;
                    const chatId = message.chat.id;
                    const userId = message.from.id;
                    const text = message.text || '';
                    const username = message.from.username || 'unknown';
                    const firstName = message.from.first_name || 'User';

                    addLog(`Message from ${firstName} (@${username}): ${text}`);

                    // Add user to database
                    const user = addUser(userId, username, firstName);

                    // Handle /start command
                    if (text === '/start') {
                        await sendMessage(chatId, WELCOME_MESSAGE);
                        
                        // Check if user needs to join channel/group
                        if (!user.hasJoinedChannel || !user.hasJoinedGroup) {
                            const keyboard = {
                                inline_keyboard: [
                                    [{ text: 'üì¢ Channel ·ÄÄ·Ä≠·ÄØ Join ·Äï·Äº·ÄØ·Äú·ÄØ·Äï·Ä∫·Äõ·Äî·Ä∫', url: CONFIG.CHANNEL_LINK }],
                                    [{ text: 'üë• Group ·ÄÄ·Ä≠·ÄØ Join ·Äï·Äº·ÄØ·Äú·ÄØ·Äï·Ä∫·Äõ·Äî·Ä∫', url: CONFIG.GROUP_LINK }],
                                    [{ text: '‚úÖ Join ·Äï·Äº·ÄØ·Äú·ÄØ·Äï·Ä∫·Äï·ÄÆ·Ä∏·Äï·Ä´·Äï·ÄÆ', callback_data: 'check_membership' }]
                                ]
                            };

                            await sendMessage(chatId, 
                                `‚ö†Ô∏è Bot ·ÄÄ·Ä≠·ÄØ ·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏·Äô·Äï·Äº·ÄØ·Äô·ÄÆ ·Ä°·Ä±·Ä¨·ÄÄ·Ä∫·Äï·Ä´·Äê·Ä≠·ÄØ·Ä∑·ÄÄ·Ä≠·ÄØ Join ·Äï·Äº·ÄØ·Äú·ÄØ·Äï·Ä∫·Äï·Ä±·Ä∏·Äõ·Äî·Ä∫ ·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·Äï·Ä´·Äû·Ää·Ä∫:\n\n` +
                                `1Ô∏è‚É£ ·ÄÄ·Äª·ÄΩ·Äî·Ä∫·Äê·Ä±·Ä¨·Ä∫·Äê·Ä≠·ÄØ·Ä∑·Åè Channel\n` +
                                `2Ô∏è‚É£ ·ÄÄ·Äª·ÄΩ·Äî·Ä∫·Äê·Ä±·Ä¨·Ä∫·Äê·Ä≠·ÄØ·Ä∑·Åè Group\n\n` +
                                `Join ·Äï·Äº·ÄØ·Äú·ÄØ·Äï·Ä∫·Äï·ÄÆ·Ä∏·Äï·Ä´·ÄÄ "‚úÖ Join ·Äï·Äº·ÄØ·Äú·ÄØ·Äï·Ä∫·Äï·ÄÆ·Ä∏·Äï·Ä´·Äï·ÄÆ" ·ÄÄ·Ä≠·ÄØ ·Äî·Äæ·Ä≠·Äï·Ä∫·Äï·Ä´·Åã`,
                                { reply_markup: keyboard }
                            );
                        }
                        return;
                    }

                    // Check membership before processing
                    if (!user.hasJoinedChannel || !user.hasJoinedGroup) {
                        const channelMember = await checkMembership(userId, CONFIG.CHANNEL_ID);
                        const groupMember = await checkMembership(userId, CONFIG.GROUP_ID);

                        if (!channelMember || !groupMember) {
                            await sendMessage(chatId, 
                                `‚õîÔ∏è ·Äû·ÄÑ·Ä∫·Äû·Ää·Ä∫ Channel ·Äî·Äæ·ÄÑ·Ä∑·Ä∫ Group ·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ Join ·Äô·Äï·Äº·ÄØ·Äú·ÄØ·Äï·Ä∫·Äõ·Äû·Ä±·Ä∏·Äï·Ä´·Åã\n\n` +
                                `/start ·ÄÄ·Ä≠·ÄØ ·Äî·Äæ·Ä≠·Äï·Ä∫·Äï·ÄÆ·Ä∏ Join ·Äï·Äº·ÄØ·Äú·ÄØ·Äï·Ä∫·Äï·Ä´·Åã`
                            );
                            return;
                        }

                        // Update user membership status
                        user.hasJoinedChannel = true;
                        user.hasJoinedGroup = true;
                        let users = JSON.parse(localStorage.getItem(STORAGE_KEYS.USERS));
                        users[userId] = user;
                        localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
                    }

                    // Process video URL
                    if (text.includes('http') || text.includes('www.')) {
                        await processVideoUrl(text, chatId, userId);
                    } else {
                        await sendMessage(chatId, 
                            `üìé ·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äï·Äº·ÄØ·Åç ·Äû·ÄÑ·Ä∫ download ·ÄÜ·ÄΩ·Ä≤·Äú·Ä≠·ÄØ·Äû·Ä±·Ä¨ video ·Åè link ·ÄÄ·Ä≠·ÄØ ·Äï·Ä≠·ÄØ·Ä∑·Äï·Ä´·Åã\n\n` +
                            `‚úÖ Supported:\n` +
                            `‚Ä¢ YouTube\n` +
                            `‚Ä¢ Facebook\n` +
                            `‚Ä¢ TikTok\n` +
                            `‚Ä¢ Instagram`
                        );
                    }
                }

                // Handle callback queries (button clicks)
                if (update.callback_query) {
                    const callbackQuery = update.callback_query;
                    const chatId = callbackQuery.message.chat.id;
                    const userId = callbackQuery.from.id;
                    const data = callbackQuery.data;

                    if (data === 'check_membership') {
                        const channelMember = await checkMembership(userId, CONFIG.CHANNEL_ID);
                        const groupMember = await checkMembership(userId, CONFIG.GROUP_ID);

                        if (channelMember && groupMember) {
                            // Update user status
                            let users = JSON.parse(localStorage.getItem(STORAGE_KEYS.USERS));
                            users[userId].hasJoinedChannel = true;
                            users[userId].hasJoinedGroup = true;
                            localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));

                            await sendMessage(chatId, 
                                `‚úÖ ·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äê·ÄÑ·Ä∫·Äï·Ä´·Äê·Äö·Ä∫! ·Äû·ÄÑ·Ä∫ Join ·Äï·Äº·ÄØ·Äú·ÄØ·Äï·Ä∫·Äï·ÄÆ·Ä∏·Äï·Ä´·Äï·ÄÆ·Åã\n\n` +
                                `üé¨ ·Äö·ÄÅ·ÄØ video link ·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äï·Ä≠·ÄØ·Ä∑·Åç download ·ÄÜ·ÄΩ·Ä≤·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äï·Ä´·Äï·ÄÆ·Åã`
                            );
                        } else {
                            let missing = [];
                            if (!channelMember) missing.push('Channel');
                            if (!groupMember) missing.push('Group');
                            
                            await sendMessage(chatId, 
                                `‚ùå ·Äû·ÄÑ·Ä∫·Äû·Ää·Ä∫ ${missing.join(' ·Äî·Äæ·ÄÑ·Ä∑·Ä∫ ')} ·ÄÄ·Ä≠·ÄØ Join ·Äô·Äï·Äº·ÄØ·Äú·ÄØ·Äï·Ä∫·Äõ·Äû·Ä±·Ä∏·Äï·Ä´·Åã\n\n` +
                                `·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äï·Äº·ÄØ·Åç Join ·Äï·Äº·ÄØ·Äú·ÄØ·Äï·Ä∫·Äï·ÄÆ·Ä∏·Äô·Äæ ·Äë·Äï·Ä∫·Äô·Ä∂·ÄÄ·Äº·Ä≠·ÄØ·Ä∏·ÄÖ·Ä¨·Ä∏·Äï·Ä´·Åã`
                            );
                        }
                    }

                    // Handle download quality selection
                    if (data.startsWith('download_')) {
                        const [_, quality, uid] = data.split('_');
                        
                        await sendMessage(chatId, 
                            `‚è≥ ${quality.toUpperCase()} quality ·Äñ·Äº·ÄÑ·Ä∑·Ä∫ download ·ÄÖ·Äê·ÄÑ·Ä∫·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫...\n\n` +
                            `·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äï·Äº·ÄØ·Åç ·ÄÅ·Äè·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äï·Ä´...`
                        );

                        // Simulate download (replace with actual download logic)
                        setTimeout(async () => {
                            await sendMessage(chatId, 
                                `‚úÖ Download ·Äï·Äº·ÄÆ·Ä∏·ÄÖ·ÄÆ·Ä∏·Äï·Ä´·Äï·ÄÆ!` + DOWNLOAD_SUCCESS_MESSAGE
                            );
                        }, 3000);
                    }

                    // Answer callback query
                    await axios.post(`https://api.telegram.org/bot${CONFIG.BOT_TOKEN}/answerCallbackQuery`, {
                        callback_query_id: callbackQuery.id
                    });
                }

            } catch (error) {
                addLog('Error handling update: ' + error.message, 'error');
            }
        }

        // Get Updates (Long Polling)
        async function getUpdates() {
            if (!botRunning) return;

            try {
                const response = await axios.get(`https://api.telegram.org/bot${CONFIG.BOT_TOKEN}/getUpdates`, {
                    params: {
                        offset: updateOffset,
                        timeout: 30
                    }
                });

                const updates = response.data.result;

                for (const update of updates) {
                    await handleUpdate(update);
                    updateOffset = update.update_id + 1;
                }

            } catch (error) {
                addLog('Error getting updates: ' + error.message, 'error');
            }

            // Continue polling
            if (botRunning) {
                setTimeout(getUpdates, 1000);
            }
        }

        // Start Bot
        async function startBot() {
            if (botRunning) {
                showAlert('Bot ·Äú·ÄØ·Äï·Ä∫·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·Äî·Ä±·Äï·Äº·ÄÆ·Ä∏·Äñ·Äº·ÄÖ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫', 'error');
                return;
            }

            try {
                // Test bot token
                const response = await axios.get(`https://api.telegram.org/bot${CONFIG.BOT_TOKEN}/getMe`);
                
                if (response.data.ok) {
                    botRunning = true;
                    document.getElementById('botStatus').textContent = '‚óè Bot ·Äú·ÄØ·Äï·Ä∫·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·Äî·Ä±·Äû·Ää·Ä∫';
                    document.getElementById('botStatus').classList.remove('offline');
                    addLog('Bot started successfully!', 'success');
                    showAlert('Bot ·ÄÖ·Äê·ÄÑ·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ!', 'success');
                    
                    // Start polling
                    getUpdates();
                } else {
                    throw new Error('Invalid bot token');
                }
            } catch (error) {
                addLog('Failed to start bot: ' + error.message, 'error');
                showAlert('Bot ·ÄÖ·Äê·ÄÑ·Ä∫·Äõ·Äî·Ä∫ ·Äô·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´: ' + error.message, 'error');
            }
        }

        // Stop Bot
        function stopBot() {
            botRunning = false;
            document.getElementById('botStatus').textContent = '‚óè Bot ·Äï·Ä≠·Äê·Ä∫·Äî·Ä±·Äû·Ää·Ä∫';
            document.getElementById('botStatus').classList.add('offline');
            addLog('Bot stopped', 'warning');
            showAlert('Bot ·Äõ·Äï·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ', 'success');
        }

        // Preview Files
        function previewFiles() {
            const files = document.getElementById('broadcastFiles').files;
            const preview = document.getElementById('filePreview');
            preview.innerHTML = '';

            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    if (file.type.startsWith('image/')) {
                        preview.innerHTML += `<img src="${e.target.result}" alt="Preview">`;
                    } else if (file.type.startsWith('video/')) {
                        preview.innerHTML += `<video src="${e.target.result}" controls></video>`;
                    }
                };
                reader.readAsDataURL(file);
            });
        }

        // Send Broadcast
        async function sendBroadcast() {
            const message = document.getElementById('broadcastMessage').value;
            const files = document.getElementById('broadcastFiles').files;

            if (!message && files.length === 0) {
                showAlert('·Äô·ÄÄ·Ä∫·ÄÜ·Ä±·Ä∑·ÄÅ·Äª·Ä∫ ·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫ ·Äñ·Ä≠·ÄØ·ÄÑ·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´', 'error');
                return;
            }

            if (!botRunning) {
                showAlert('Bot ·ÄÄ·Ä≠·ÄØ ·Ä¶·Ä∏·ÄÖ·ÄΩ·Ä¨ ·ÄÖ·Äê·ÄÑ·Ä∫·Äï·Ä´', 'error');
                return;
            }

            const users = JSON.parse(localStorage.getItem(STORAGE_KEYS.USERS) || '{}');
            const userIds = Object.keys(users);

            if (userIds.length === 0) {
                showAlert('Users ·Äô·Äª·Ä¨·Ä∏ ·Äô·Äõ·Äæ·Ä≠·Äû·Ä±·Ä∏·Äï·Ä´', 'error');
                return;
            }

            document.getElementById('broadcastLoading').classList.add('show');

            let successCount = 0;
            let errorCount = 0;

            for (const userId of userIds) {
                try {
                    // Send text message
                    if (message) {
                        await sendMessage(userId, message);
                    }

                    // Send files
                    for (const file of files) {
                        if (file.type.startsWith('image/')) {
                            await sendPhoto(userId, file, message);
                        } else if (file.type.startsWith('video/')) {
                            await sendVideo(userId, file, message);
                        }
                    }

                    successCount++;
                    addLog(`Broadcast sent to user ${userId}`, 'success');
                } catch (error) {
                    errorCount++;
                    addLog(`Failed to send to user ${userId}: ${error.message}`, 'error');
                }

                // Small delay to avoid rate limiting
                await new Promise(resolve => setTimeout(resolve, 100));
            }

            document.getElementById('broadcastLoading').classList.remove('show');
            showAlert(`·Äï·Ä≠·ÄØ·Ä∑·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ! ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫: ${successCount}, ·Äô·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫: ${errorCount}`, 'success');
            
            // Clear form
            document.getElementById('broadcastMessage').value = '';
            document.getElementById('broadcastFiles').value = '';
            document.getElementById('filePreview').innerHTML = '';
        }

        // Show Alert
        function showAlert(message, type = 'success') {
            const alertBox = document.getElementById('alertBox');
            alertBox.textContent = message;
            alertBox.className = `alert ${type} show`;

            setTimeout(() => {
                alertBox.classList.remove('show');
            }, 5000);
        }

        // Add Log
        function addLog(message, type = 'info') {
            const logs = document.getElementById('botLogs');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logs.appendChild(logEntry);
            logs.scrollTop = logs.scrollHeight;
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            initStats();
            addLog('Admin panel loaded successfully');
            
            // Auto-start bot (optional)
            // startBot();
        });

        // Prevent page unload if bot is running
        window.addEventListener('beforeunload', (e) => {
            if (botRunning) {
                e.preventDefault();
                e.returnValue = 'Bot ·Äú·ÄØ·Äï·Ä∫·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫·Åã ·Äï·Ä≠·Äê·Ä∫·Äô·Ää·Ä∫·Äô·Äæ·Ä¨ ·Äû·Ä±·ÄÅ·Äª·Ä¨·Äï·Ä´·Äû·Äú·Ä¨·Ä∏?';
            }
        });
    </script>
</body>
</html>

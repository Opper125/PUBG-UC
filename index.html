<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Website Builder Pro - Myanmar Edition</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>ü§ñ AI Builder Pro</h1>
                <span class="version">v2.5 Ultimate</span>
            </div>

            <!-- AI Model Selector -->
            <div class="model-selector">
                <label>üß† AI Model Selection:</label>
                <select id="aiModelSelect">
                    <option value="gpt-4-turbo">GPT-4 Turbo (Unlimited)</option>
                    <option value="gpt-4">GPT-4 (Unlimited)</option>
                    <option value="gpt-3.5-turbo" selected>GPT-3.5 Turbo (Unlimited)</option>
                    <option value="claude-sonnet-4-5-20250929">Claude Sonnet 4.5 (2025) üî•</option>
                    <option value="claude-3-opus">Claude 3 Opus (Unlimited)</option>
                    <option value="claude-3-sonnet">Claude 3 Sonnet (Unlimited)</option>
                    <option value="gemini-pro-ultra">Gemini Pro Ultra (Unlimited)</option>
                    <option value="gemini-pro">Gemini Pro (Unlimited)</option>
                    <option value="llama-3-70b">Llama 3 70B (Unlimited)</option>
                    <option value="llama-3-405b">Llama 3 405B (Unlimited)</option>
                    <option value="mistral-large">Mistral Large (Unlimited)</option>
                    <option value="mixtral-8x22b">Mixtral 8x22B (Unlimited)</option>
                    <option value="mixtral-8x7b">Mixtral 8x7B (Unlimited)</option>
                    <option value="command-r-plus">Cohere Command R+ (Unlimited)</option>
                    <option value="deepseek-coder">DeepSeek Coder (Unlimited)</option>
                </select>
                <div class="model-info">
                    <small>üîì Unlimited Tokens ‚Ä¢ No Limits</small>
                </div>
            </div>

            <!-- Project Management -->
            <div class="project-section">
                <h3>üìÅ My Projects</h3>
                <div id="projectsList" class="projects-list"></div>
                <button class="btn-new-project" onclick="createNewProject()">
                    <i class="fas fa-plus"></i> New Project
                </button>
            </div>

            <!-- Session Info -->
            <div class="session-info">
                <div class="info-row">
                    <i class="fas fa-database"></i>
                    <span>Storage: <strong id="storageUsed">0 KB</strong></span>
                </div>
                <div class="info-row">
                    <i class="fas fa-clock"></i>
                    <span>Active: <strong id="sessionTime">0:00</strong></span>
                </div>
                <div class="info-row">
                    <i class="fas fa-comments"></i>
                    <span>Messages: <strong id="messageCount">0</strong></span>
                </div>
                <button class="btn-reset" onclick="resetSession()">
                    <i class="fas fa-redo"></i> Reset All Data
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Navbar -->
            <nav class="top-navbar">
                <div class="nav-tabs">
                    <button class="tab-btn active" data-tab="chat">
                        <i class="fas fa-comments"></i> Chat
                    </button>
                    <button class="tab-btn" data-tab="code">
                        <i class="fas fa-code"></i> Code Editor
                    </button>
                    <button class="tab-btn" data-tab="preview">
                        <i class="fas fa-eye"></i> Live Preview
                    </button>
                    <button class="tab-btn" data-tab="files">
                        <i class="fas fa-folder"></i> Files
                    </button>
                    <button class="tab-btn" data-tab="settings">
                        <i class="fas fa-cog"></i> Settings
                    </button>
                </div>
                <div class="nav-actions">
                    <button class="btn-action" onclick="exportProject()" title="Export Project">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="btn-action" onclick="document.getElementById('importFiles').click()" title="Import Files">
                        <i class="fas fa-upload"></i>
                    </button>
                    <button class="btn-action" onclick="shareProject()" title="Share">
                        <i class="fas fa-share-alt"></i>
                    </button>
                    <input type="file" id="importFiles" multiple hidden onchange="importFiles(event)">
                </div>
            </nav>

            <!-- Chat Tab -->
            <div class="tab-content active" id="chatTab">
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="welcome-message">
                            <div class="welcome-icon">üé®</div>
                            <h2>Welcome to AI Website Builder Pro!</h2>
                            <p>·ÄÄ·Äª·ÄΩ·Äî·Ä∫·Äê·Ä±·Ä¨·Ä∫·Äû·Ää·Ä∫ Advanced AI Assistant ·Äñ·Äº·ÄÖ·Ä∫·Äï·Äº·ÄÆ·Ä∏ ·Äû·ÄÑ·Ä∑·Ä∫·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ Professional Website ·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Ä°·Äú·ÄΩ·Äö·Ä∫·Äê·ÄÄ·Ä∞ ·Äñ·Äî·Ä∫·Äê·ÄÆ·Ä∏·Äï·Ä±·Ä∏·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫·Åã</p>
                            
                            <div class="features-grid">
                                <div class="feature-card">
                                    <i class="fas fa-robot"></i>
                                    <h4>15+ AI Models</h4>
                                    <p>Unlimited tokens</p>
                                </div>
                                <div class="feature-card">
                                    <i class="fas fa-code"></i>
                                    <h4>Live Code Editor</h4>
                                    <p>Real-time preview</p>
                                </div>
                                <div class="feature-card">
                                    <i class="fas fa-mobile-alt"></i>
                                    <h4>Responsive</h4>
                                    <p>All devices</p>
                                </div>
                                <div class="feature-card">
                                    <i class="fas fa-bolt"></i>
                                    <h4>No Database</h4>
                                    <p>Session storage</p>
                                </div>
                            </div>

                            <div class="example-prompts">
                                <p><strong>üöÄ Quick Start - Try these:</strong></p>
                                <button class="prompt-btn" onclick="sendPrompt('Modern e-commerce website with product cards, shopping cart, and checkout page ·Äñ·Äî·Ä∫·Äê·ÄÆ·Ä∏·Äï·Ä±·Ä∏·Äï·Ä´')">
                                    <i class="fas fa-shopping-cart"></i> E-commerce Website
                                </button>
                                <button class="prompt-btn" onclick="sendPrompt('Professional portfolio website with animations, dark theme, project showcase ·Äõ·Ä±·Ä∏·Äï·Ä±·Ä∏·Äï·Ä´')">
                                    <i class="fas fa-briefcase"></i> Portfolio
                                </button>
                                <button class="prompt-btn" onclick="sendPrompt('Landing page with hero section, features, testimonials, contact form')">
                                    <i class="fas fa-rocket"></i> Landing Page
                                </button>
                                <button class="prompt-btn" onclick="sendPrompt('Admin dashboard with sidebar, charts, tables, dark mode toggle')">
                                    <i class="fas fa-chart-line"></i> Dashboard
                                </button>
                                <button class="prompt-btn" onclick="sendPrompt('Blog website with posts grid, single post page, comments section')">
                                    <i class="fas fa-blog"></i> Blog Website
                                </button>
                                <button class="prompt-btn" onclick="sendPrompt('Restaurant website with menu, online ordering, reservation system')">
                                    <i class="fas fa-utensils"></i> Restaurant Site
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <div class="input-wrapper">
                            <textarea 
                                id="chatInput" 
                                placeholder="Website ·Ä°·ÄÄ·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏ ·Ä°·Äû·Ä±·Ä∏·ÄÖ·Ä≠·Äê·Ä∫·Äõ·Ä±·Ä∏·Äï·Ä´... (Ctrl+Enter to send)"
                                rows="3"
                            ></textarea>
                            <div class="input-actions">
                                <button class="btn-attach" onclick="attachReference()" title="Attach Reference">
                                    <i class="fas fa-paperclip"></i>
                                </button>
                                <button class="btn-voice" onclick="startVoiceInput()" title="Voice Input">
                                    <i class="fas fa-microphone"></i>
                                </button>
                                <button class="btn-clear" onclick="clearChat()" title="Clear Chat">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="btn-send" onclick="sendMessage()">
                                    <i class="fas fa-paper-plane"></i> Generate
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Code Tab -->
            <div class="tab-content" id="codeTab">
                <div class="code-editor-container">
                    <div class="editor-header">
                        <div class="editor-tabs" id="editorTabs">
                            <button class="editor-tab active" data-file="index.html">
                                <i class="fab fa-html5"></i> index.html
                            </button>
                            <button class="editor-tab" data-file="styles.css">
                                <i class="fab fa-css3-alt"></i> styles.css
                            </button>
                            <button class="editor-tab" data-file="script.js">
                                <i class="fab fa-js"></i> script.js
                            </button>
                        </div>
                        <button class="btn-add-file" onclick="addNewFile()">
                            <i class="fas fa-plus"></i> Add File
                        </button>
                    </div>
                    
                    <div class="editor-toolbar">
                        <button onclick="formatCode()" title="Format Code">
                            <i class="fas fa-magic"></i> Format
                        </button>
                        <button onclick="copyCode()" title="Copy Code">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                        <button onclick="downloadCode()" title="Download File">
                            <i class="fas fa-download"></i> Download
                        </button>
                        <button onclick="beautifyCode()" title="Beautify">
                            <i class="fas fa-brush"></i> Beautify
                        </button>
                        <button onclick="toggleFullscreen()" title="Fullscreen">
                            <i class="fas fa-expand"></i> Fullscreen
                        </button>
                        <div class="editor-info">
                            Lines: <span id="lineCount">0</span> | 
                            Chars: <span id="charCount">0</span>
                        </div>
                    </div>
                    
                    <textarea id="codeEditor"></textarea>
                </div>
            </div>

            <!-- Preview Tab -->
            <div class="tab-content" id="previewTab">
                <div class="preview-toolbar">
                    <button onclick="refreshPreview()" class="active">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                    <button onclick="toggleDeviceMode('desktop')" class="device-btn active" data-device="desktop">
                        <i class="fas fa-desktop"></i> Desktop
                    </button>
                    <button onclick="toggleDeviceMode('tablet')" class="device-btn" data-device="tablet">
                        <i class="fas fa-tablet-alt"></i> Tablet
                    </button>
                    <button onclick="toggleDeviceMode('mobile')" class="device-btn" data-device="mobile">
                        <i class="fas fa-mobile-alt"></i> Mobile
                    </button>
                    <button onclick="openInNewTab()">
                        <i class="fas fa-external-link-alt"></i> New Tab
                    </button>
                    <button onclick="toggleDevTools()">
                        <i class="fas fa-tools"></i> DevTools
                    </button>
                </div>
                <div class="preview-container desktop" id="previewContainer">
                    <iframe id="previewFrame" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
                </div>
            </div>

            <!-- Files Tab -->
            <div class="tab-content" id="filesTab">
                <div class="files-manager">
                    <div class="files-toolbar">
                        <button onclick="uploadFiles()">
                            <i class="fas fa-cloud-upload-alt"></i> Upload Files
                        </button>
                        <button onclick="createFolder()">
                            <i class="fas fa-folder-plus"></i> New Folder
                        </button>
                        <button onclick="deleteSelected()">
                            <i class="fas fa-trash-alt"></i> Delete
                        </button>
                        <button onclick="downloadAllFiles()">
                            <i class="fas fa-file-archive"></i> Download All
                        </button>
                    </div>
                    <div class="files-tree" id="filesTree"></div>
                    <div class="file-preview" id="filePreview">
                        <p>Select a file to preview</p>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" id="settingsTab">
                <div class="settings-container">
                    <h2><i class="fas fa-cog"></i> Settings</h2>
                    
                    <div class="settings-section">
                        <h3>üé® Editor Settings</h3>
                        <div class="setting-item">
                            <label>Theme:</label>
                            <select id="editorTheme" onchange="changeEditorTheme(this.value)">
                                <option value="dracula" selected>Dracula (Dark)</option>
                                <option value="monokai">Monokai</option>
                                <option value="material">Material</option>
                                <option value="solarized">Solarized</option>
                                <option value="default">Default (Light)</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>Font Size:</label>
                            <input type="number" id="fontSize" value="14" min="10" max="24" onchange="changeFontSize(this.value)">
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="autoSave" checked onchange="toggleAutoSave(this.checked)">
                                Auto Save (Every 5 seconds)
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="livePreview" checked onchange="toggleLivePreview(this.checked)">
                                Live Preview Update
                            </label>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>ü§ñ AI Settings</h3>
                        <div class="setting-item">
                            <label>Temperature (Creativity):</label>
                            <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.7" oninput="updateTemperature(this.value)">
                            <span id="tempValue">0.7</span>
                        </div>
                        <div class="setting-item">
                            <label>Max Response Length:</label>
                            <select id="maxTokens">
                                <option value="unlimited" selected>Unlimited</option>
                                <option value="16000">16,000 tokens</option>
                                <option value="8000">8,000 tokens</option>
                                <option value="4000">4,000 tokens</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="codeComments" checked>
                                Include Code Comments
                            </label>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>üíæ Data Management</h3>
                        <button class="btn-danger" onclick="clearAllData()">
                            <i class="fas fa-exclamation-triangle"></i> Clear All Data
                        </button>
                        <button onclick="exportAllData()">
                            <i class="fas fa-file-export"></i> Export All Data
                        </button>
                        <button onclick="importData()">
                            <i class="fas fa-file-import"></i> Import Data
                        </button>
                    </div>

                    <div class="settings-section">
                        <h3>‚ÑπÔ∏è About</h3>
                        <p><strong>AI Website Builder Pro</strong></p>
                        <p>Version: 2.5 Ultimate</p>
                        <p>Build Date: 2025</p>
                        <p>¬© Powered by Multiple AI Models</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- AI Assistant Panel -->
        <aside class="ai-panel">
            <div class="ai-panel-header">
                <h3><i class="fas fa-robot"></i> AI Assistant</h3>
                <button onclick="toggleAIPanel()" class="toggle-panel">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <div class="ai-panel-content">
                <!-- AI Status -->
                <div class="ai-status-card">
                    <div class="status-header">
                        <span>Status:</span>
                        <span id="aiStatus" class="status-ready">Ready</span>
                    </div>
                    <div class="status-indicator">
                        <div class="pulse-dot"></div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <h4><i class="fas fa-bolt"></i> Quick Actions</h4>
                    <button onclick="improveCode()">
                        <i class="fas fa-magic"></i> Improve Code
                    </button>
                    <button onclick="explainCode()">
                        <i class="fas fa-question-circle"></i> Explain Code
                    </button>
                    <button onclick="debugCode()">
                        <i class="fas fa-bug"></i> Debug
                    </button>
                    <button onclick="optimizeCode()">
                        <i class="fas fa-tachometer-alt"></i> Optimize
                    </button>
                    <button onclick="addFeature()">
                        <i class="fas fa-plus-circle"></i> Add Feature
                    </button>
                </div>

                <!-- Suggestions -->
                <div class="suggestions-card">
                    <h4><i class="fas fa-lightbulb"></i> Suggestions</h4>
                    <ul id="suggestionsList">
                        <li onclick="applySuggestion('Add responsive breakpoints')">
                            <i class="fas fa-mobile"></i> Add responsive design
                        </li>
                        <li onclick="applySuggestion('Improve accessibility with ARIA labels')">
                            <i class="fas fa-universal-access"></i> Improve accessibility
                        </li>
                        <li onclick="applySuggestion('Add animations and transitions')">
                            <i class="fas fa-magic"></i> Add animations
                        </li>
                        <li onclick="applySuggestion('Optimize performance')">
                            <i class="fas fa-rocket"></i> Optimize performance
                        </li>
                    </ul>
                </div>

                <!-- AI Models Info -->
                <div class="models-info">
                    <h4><i class="fas fa-server"></i> Active Model</h4>
                    <div id="currentModelInfo" class="model-badge">
                        GPT-3.5 Turbo
                    </div>
                    <small>Unlimited tokens ‚Ä¢ No rate limits</small>
                </div>
            </div>
        </aside>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner-container">
                <div class="spinner"></div>
                <div class="spinner-ring"></div>
            </div>
            <h3 id="loadingText">AI ·ÄÄ website ·Äñ·Äî·Ä∫·Äê·ÄÆ·Ä∏·Äî·Ä±·Äï·Ä´·Äê·Äö·Ä∫...</h3>
            <p id="loadingSubtext">Please wait...</p>
            <div class="loading-progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toastContainer"></div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>

    <script>
    // ============================================
    // CONFIGURATION - API Keys & Settings
    // ============================================
    const CONFIG = {
        // ‚ö†Ô∏è IMPORTANT: ·Äû·ÄÑ·Ä∑·Ä∫ API Key ·ÄÄ·Ä≠·ÄØ ·Äí·ÄÆ·Äî·Ä±·Äõ·Ä¨·Äô·Äæ·Ä¨ ·Äê·Ä≠·ÄØ·ÄÄ·Ä∫·Äõ·Ä≠·ÄØ·ÄÄ·Ä∫ ·Äë·Ää·Ä∑·Ä∫·Äë·Ä¨·Ä∏·Äï·Ä´·Äê·Äö·Ä∫
        API_KEY: 'v1:xX29C4DkFKI8LCpeJ5hPFhTs:fH8wRqOypgVZo8yKyF4XOALN',
        
        API_ENDPOINTS: {
            PRIMARY: 'https://api.vercel.com/v1/ai/chat',
            FALLBACK: 'https://api.openai.com/v1/chat/completions',
            ANTHROPIC: 'https://api.anthropic.com/v1/messages'
        },

        MODELS: {
            'gpt-4-turbo': {
                name: 'GPT-4 Turbo',
                maxTokens: 999999999,
                provider: 'openai'
            },
            'gpt-4': {
                name: 'GPT-4',
                maxTokens: 999999999,
                provider: 'openai'
            },
            'gpt-3.5-turbo': {
                name: 'GPT-3.5 Turbo',
                maxTokens: 999999999,
                provider: 'openai'
            },
            'claude-sonnet-4-5-20250929': {
                name: 'Claude Sonnet 4.5 (2025-09-29)',
                maxTokens: 999999999,
                provider: 'anthropic',
                model: 'claude-sonnet-4.5-20250929'
            },
            'claude-3-opus': {
                name: 'Claude 3 Opus',
                maxTokens: 999999999,
                provider: 'anthropic'
            },
            'claude-3-sonnet': {
                name: 'Claude 3 Sonnet',
                maxTokens: 999999999,
                provider: 'anthropic'
            },
            'gemini-pro-ultra': {
                name: 'Gemini Pro Ultra',
                maxTokens: 999999999,
                provider: 'google'
            },
            'gemini-pro': {
                name: 'Gemini Pro',
                maxTokens: 999999999,
                provider: 'google'
            },
            'llama-3-70b': {
                name: 'Llama 3 70B',
                maxTokens: 999999999,
                provider: 'meta'
            },
            'llama-3-405b': {
                name: 'Llama 3 405B',
                maxTokens: 999999999,
                provider: 'meta'
            },
            'mistral-large': {
                name: 'Mistral Large',
                maxTokens: 999999999,
                provider: 'mistral'
            },
            'mixtral-8x22b': {
                name: 'Mixtral 8x22B',
                maxTokens: 999999999,
                provider: 'mistral'
            },
            'mixtral-8x7b': {
                name: 'Mixtral 8x7B',
                maxTokens: 999999999,
                provider: 'mistral'
            },
            'command-r-plus': {
                name: 'Cohere Command R+',
                maxTokens: 999999999,
                provider: 'cohere'
            },
            'deepseek-coder': {
                name: 'DeepSeek Coder',
                maxTokens: 999999999,
                provider: 'deepseek'
            }
        },

        SETTINGS: {
            autoSave: true,
            saveInterval: 5000,
            livePreview: true,
            temperature: 0.7,
            editorTheme: 'dracula',
            fontSize: 14
        }
    };

    // ============================================
    // AI ENGINE CLASS
    // ============================================
    class AIEngine {
        constructor() {
            this.conversationHistory = [];
            this.currentModel = 'gpt-3.5-turbo';
            this.temperature = CONFIG.SETTINGS.temperature;
            this.messageCount = 0;
            
            this.systemPrompt = `You are an expert Full-Stack Web Developer AI Assistant with unlimited capabilities.

Your responsibilities:
1. Create complete, production-ready websites using HTML, CSS, and JavaScript
2. Design modern, responsive, and beautiful UI/UX
3. Write clean, well-commented, and optimized code
4. Follow best practices and web standards
5. Support both Myanmar and English languages
6. Include animations, transitions, and interactive features
7. Ensure mobile-first responsive design
8. Add accessibility features (ARIA labels, semantic HTML)
9. Optimize performance and SEO

IMPORTANT:
- Always provide COMPLETE, WORKING code
- Include ALL necessary HTML, CSS, and JavaScript
- Make designs modern and professional
- Add detailed comments in the code
- Ensure cross-browser compatibility
- Use latest web technologies and best practices

When user requests a website:
1. Analyze requirements carefully
2. Create comprehensive HTML structure
3. Style with modern CSS (flexbox, grid, animations)
4. Add JavaScript for interactivity
5. Ensure responsive design for all devices
6. Include helpful code comments

Always respond with complete, copy-paste ready code blocks.`;
        }

        async generateWebsite(userPrompt) {
            try {
                this.conversationHistory.push({
                    role: 'user',
                    content: userPrompt
                });

                const messages = [
                    { role: 'system', content: this.systemPrompt },
                    ...this.conversationHistory
                ];

                const response = await this.callAI(messages);
                
                this.conversationHistory.push({
                    role: 'assistant',
                    content: response
                });

                this.messageCount++;
                updateMessageCount();

                const parsedCode = this.parseCodeFromResponse(response);

                return {
                    success: true,
                    response: response,
                    code: parsedCode,
                    model: this.currentModel
                };

            } catch (error) {
                console.error('AI Error:', error);
                return {
                    success: false,
                    error: error.message
                };
            }
        }

        async callAI(messages) {
            const modelConfig = CONFIG.MODELS[this.currentModel];
            
            const requestBody = {
                model: this.currentModel,
                messages: messages,
                temperature: this.temperature,
                max_tokens: modelConfig.maxTokens,
                stream: false
            };

            const headers = {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${CONFIG.API_KEY}`
            };

            let endpoint = CONFIG.API_ENDPOINTS.PRIMARY;

            // Use specific endpoint for Anthropic models
            if (modelConfig.provider === 'anthropic') {
                endpoint = CONFIG.API_ENDPOINTS.ANTHROPIC;
                headers['anthropic-version'] = '2023-06-01';
                headers['x-api-key'] = CONFIG.API_KEY;
                delete headers['Authorization'];
            }

            const response = await fetch(endpoint, {
                method: 'POST',
                headers: headers,
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                throw new Error(`API Error: ${response.status} ${response.statusText}`);
            }

            const data = await response.json();

            // Extract response based on provider
            if (modelConfig.provider === 'anthropic') {
                return data.content[0].text;
            } else {
                return data.choices[0].message.content;
            }
        }

        parseCodeFromResponse(response) {
            const codeBlocks = {
                html: '',
                css: '',
                javascript: ''
            };

            // Extract HTML
            const htmlMatch = response.match(/```html\n([\s\S]*?)```/i);
            if (htmlMatch) {
                codeBlocks.html = htmlMatch[1].trim();
            }

            // Extract CSS
            const cssMatch = response.match(/```css\n([\s\S]*?)```/i);
            if (cssMatch) {
                codeBlocks.css = cssMatch[1].trim();
            }

            // Extract JavaScript
            const jsMatch = response.match(/```(?:javascript|js)\n([\s\S]*?)```/i);
            if (jsMatch) {
                codeBlocks.javascript = jsMatch[1].trim();
            }

            // If no specific blocks found, try to extract any code
            if (!codeBlocks.html && !codeBlocks.css && !codeBlocks.javascript) {
                const anyCode = response.match(/```[\s\S]*?```/g);
                if (anyCode) {
                    anyCode.forEach(block => {
                        const content = block.replace(/```\w*\n?/, '').replace(/```$/, '').trim();
                        if (content.includes('<!DOCTYPE') || content.includes('<html')) {
                            codeBlocks.html = content;
                        } else if (content.includes('{') && content.includes('}') && !content.includes('function')) {
                            codeBlocks.css = content;
                        } else if (content.includes('function') || content.includes('const ') || content.includes('let ')) {
                            codeBlocks.javascript = content;
                        }
                    });
                }
            }

            return codeBlocks;
        }

        setModel(model) {
            if (CONFIG.MODELS[model]) {
                this.currentModel = model;
                updateCurrentModelInfo();
                return true;
            }
            return false;
        }

        resetConversation() {
            this.conversationHistory = [];
            this.messageCount = 0;
        }
    }

    // ============================================
    // GLOBAL VARIABLES
    // ============================================
    let aiEngine = new AIEngine();
    let codeEditor = null;
    let currentFile = 'index.html';
    let files = {
        'index.html': '',
        'styles.css': '',
        'script.js': ''
    };
    let projects = [];
    let currentProject = null;
    let sessionStartTime = Date.now();
    let autoSaveInterval = null;
    let isFullscreen = false;

    // ============================================
    // INITIALIZATION
    // ============================================
    document.addEventListener('DOMContentLoaded', () => {
        initializeApp();
    });

    function initializeApp() {
        console.log('üöÄ Initializing AI Website Builder Pro...');
        
        loadSession();
        initializeCodeEditor();
        setupEventListeners();
        startSessionTimer();
        loadProjects();
        updateStorageInfo();
        updateCurrentModelInfo();
        
        if (CONFIG.SETTINGS.autoSave) {
            startAutoSave();
        }

        showToast('‚úÖ Application loaded successfully!', 'success');
        console.log('‚úÖ AI Website Builder Pro ready!');
    }

    function initializeCodeEditor() {
        const textarea = document.getElementById('codeEditor');
        
        codeEditor = CodeMirror.fromTextArea(textarea, {
            mode: 'htmlmixed',
            theme: CONFIG.SETTINGS.editorTheme,
            lineNumbers: true,
            autoCloseTags: true,
            autoCloseBrackets: true,
            matchBrackets: true,
            indentUnit: 2,
            tabSize: 2,
            lineWrapping: true,
            extraKeys: {
                "Ctrl-Space": "autocomplete",
                "F11": toggleFullscreen,
                "Esc": exitFullscreen
            }
        });

        codeEditor.setSize('100%', '100%');

        codeEditor.on('change', () => {
            files[currentFile] = codeEditor.getValue();
            updateEditorInfo();
            
            if (CONFIG.SETTINGS.livePreview) {
                updatePreview();
            }
        });

        codeEditor.setValue(files[currentFile] || '');
    }

    function setupEventListeners() {
        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const tab = e.currentTarget.dataset.tab;
                switchTab(tab);
            });
        });

        // Editor tabs
        document.querySelectorAll('.editor-tab').forEach(tab => {
            tab.addEventListener('click', (e) => {
                const file = e.currentTarget.dataset.file;
                switchEditorTab(file);
            });
        });

        // Chat input
        const chatInput = document.getElementById('chatInput');
        chatInput.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                sendMessage();
            }
        });

        // Model selector
        document.getElementById('aiModelSelect').addEventListener('change', (e) => {
            aiEngine.setModel(e.target.value);
            showToast(`Model switched to ${CONFIG.MODELS[e.target.value].name}`, 'info');
        });

        // Save on page unload
        window.addEventListener('beforeunload', () => {
            saveSession();
        });

        // Prevent accidental close
        window.addEventListener('beforeunload', (e) => {
            if (files['index.html'] || files['styles.css'] || files['script.js']) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    }

    // ============================================
    // TAB MANAGEMENT
    // ============================================
    function switchTab(tabName) {
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(tabName + 'Tab').classList.add('active');

        if (tabName === 'code') {
            setTimeout(() => codeEditor.refresh(), 100);
        }

        if (tabName === 'preview') {
            updatePreview();
        }

        if (tabName === 'files') {
            renderFilesTree();
        }
    }

    function switchEditorTab(fileName) {
        currentFile = fileName;

        document.querySelectorAll('.editor-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        document.querySelector(`[data-file="${fileName}"]`).classList.add('active');

        let mode = 'htmlmixed';
        if (fileName.endsWith('.css')) mode = 'css';
        if (fileName.endsWith('.js')) mode = 'javascript';

        codeEditor.setOption('mode', mode);
        codeEditor.setValue(files[fileName] || '');
        codeEditor.refresh();
    }

    // ============================================
    // AI CHAT FUNCTIONS
    // ============================================
    async function sendMessage() {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();

        if (!message) {
            showToast('Please enter a message', 'warning');
            return;
        }

        input.value = '';
        addMessageToChat(message, 'user');
        
        showLoading('AI ·ÄÄ website ·Äñ·Äî·Ä∫·Äê·ÄÆ·Ä∏·Äî·Ä±·Äï·Ä´·Äê·Äö·Ä∫...', 'Processing your request...');

        try {
            const result = await aiEngine.generateWebsite(message);

            hideLoading();

            if (result.success) {
                addMessageToChat(result.response, 'ai');

                if (result.code.html) files['index.html'] = result.code.html;
                if (result.code.css) files['styles.css'] = result.code.css;
                if (result.code.javascript) files['script.js'] = result.code.javascript;

                codeEditor.setValue(files[currentFile]);
                updatePreview();
                
                showToast('‚úÖ Website generated successfully!', 'success');
            } else {
                addMessageToChat(`‚ùå Error: ${result.error}`, 'ai');
                showToast('Failed to generate website', 'error');
            }

        } catch (error) {
            hideLoading();
            addMessageToChat(`‚ùå Error: ${error.message}`, 'ai');
            showToast(`Error: ${error.message}`, 'error');
        }
    }

    function sendPrompt(prompt) {
        document.getElementById('chatInput').value = prompt;
        sendMessage();
    }

    function addMessageToChat(content, sender) {
        const chatMessages = document.getElementById('chatMessages');
        
        const welcomeMsg = chatMessages.querySelector('.welcome-message');
        if (welcomeMsg) welcomeMsg.remove();

        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${sender}`;
        
        const avatar = document.createElement('div');
        avatar.className = 'message-avatar';
        avatar.innerHTML = sender === 'user' ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';

        const messageContent = document.createElement('div');
        messageContent.className = 'message-content';
        messageContent.innerHTML = formatMessage(content);

        messageDiv.appendChild(avatar);
        messageDiv.appendChild(messageContent);
        chatMessages.appendChild(messageDiv);

        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function formatMessage(text) {
        // Code blocks
        text = text.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, lang, code) => {
            return `<pre><code class="language-${lang || 'plaintext'}">${escapeHtml(code)}</code></pre>`;
        });

        // Bold
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        
        // Italic
        text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
        
        // Links
        text = text.replace(/```math
([^```]+)```KATEX_INLINE_OPEN([^)]+)KATEX_INLINE_CLOSE/g, '<a href="$2" target="_blank">$1</a>');
        
        // Line breaks
        text = text.replace(/\n/g, '<br>');

        return text;
    }

    function escapeHtml(text) {
        const map = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
        };
        return text.replace(/[&<>"']/g, m => map[m]);
    }

    function clearChat() {
        if (!confirm('Clear all chat messages?')) return;
        
        const chatMessages = document.getElementById('chatMessages');
        chatMessages.innerHTML = '<div class="welcome-message"><h2>Chat cleared</h2></div>';
        
        aiEngine.resetConversation();
        showToast('Chat cleared', 'info');
    }

    // ============================================
    // CODE EDITOR FUNCTIONS
    // ============================================
    function formatCode() {
        const code = codeEditor.getValue();
        // Simple formatting (in production, use a proper formatter like Prettier)
        codeEditor.setValue(code);
        showToast('Code formatted', 'success');
    }

    function copyCode() {
        const code = codeEditor.getValue();
        navigator.clipboard.writeText(code).then(() => {
            showToast('Code copied to clipboard!', 'success');
        });
    }

    function downloadCode() {
        const code = codeEditor.getValue();
        const blob = new Blob([code], { type: 'text/plain' });
        downloadFile(blob, currentFile);
        showToast(`${currentFile} downloaded`, 'success');
    }

    function beautifyCode() {
        formatCode();
    }

    function toggleFullscreen() {
        const container = document.querySelector('.code-editor-container');
        
        if (!isFullscreen) {
            container.classList.add('fullscreen');
            isFullscreen = true;
        } else {
            container.classList.remove('fullscreen');
            isFullscreen = false;
        }
        
        codeEditor.refresh();
    }

    function exitFullscreen() {
        if (isFullscreen) {
            toggleFullscreen();
        }
    }

    function updateEditorInfo() {
        const code = codeEditor.getValue();
        document.getElementById('lineCount').textContent = code.split('\n').length;
        document.getElementById('charCount').textContent = code.length;
    }

    function addNewFile() {
        const fileName = prompt('Enter file name (e.g., custom.js):');
        if (!fileName) return;

        if (files[fileName]) {
            showToast('File already exists', 'warning');
            return;
        }

        files[fileName] = '';

        const tabsContainer = document.querySelector('.editor-tabs');
        const newTab = document.createElement('button');
        newTab.className = 'editor-tab';
        newTab.dataset.file = fileName;
        
        let icon = 'fa-file-code';
        if (fileName.endsWith('.html')) icon = 'fa-html5';
        if (fileName.endsWith('.css')) icon = 'fa-css3-alt';
        if (fileName.endsWith('.js')) icon = 'fa-js';
        
        newTab.innerHTML = `<i class="fab ${icon}"></i> ${fileName}`;
        newTab.onclick = () => switchEditorTab(fileName);

        tabsContainer.appendChild(newTab);
        switchEditorTab(fileName);
        
        showToast(`File ${fileName} created`, 'success');
    }

    // ============================================
    // PREVIEW FUNCTIONS
    // ============================================
    function updatePreview() {
        const previewFrame = document.getElementById('previewFrame');
        
        const html = files['index.html'] || '';
        const css = files['styles.css'] || '';
        const js = files['script.js'] || '';

        const fullHTML = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preview</title>
    <style>${css}</style>
</head>
<body>
${html}
<script>${js}<\/script>
</body>
</html>`;

        const blob = new Blob([fullHTML], { type: 'text/html' });
        previewFrame.src = URL.createObjectURL(blob);
    }

    function refreshPreview() {
        updatePreview();
        showToast('Preview refreshed', 'success');
    }

    function toggleDeviceMode(mode) {
        const container = document.getElementById('previewContainer');
        container.className = `preview-container ${mode}`;

        document.querySelectorAll('.device-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`[data-device="${mode}"]`).classList.add('active');
    }

    function openInNewTab() {
        const html = files['index.html'] || '';
        const css = files['styles.css'] || '';
        const js = files['script.js'] || '';

        const fullHTML = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generated Website</title>
    <style>${css}</style>
</head>
<body>
${html}
<script>${js}<\/script>
</body>
</html>`;

        const newWindow = window.open();
        newWindow.document.write(fullHTML);
        newWindow.document.close();
    }

    function toggleDevTools() {
        showToast('DevTools feature coming soon', 'info');
    }

    // ============================================
    // FILES MANAGEMENT
    // ============================================
    function renderFilesTree() {
        const tree = document.getElementById('filesTree');
        tree.innerHTML = '';

        Object.keys(files).forEach(fileName => {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            
            let icon = 'fa-file-code';
            if (fileName.endsWith('.html')) icon = 'fa-html5';
            if (fileName.endsWith('.css')) icon = 'fa-css3-alt';
            if (fileName.endsWith('.js')) icon = 'fa-js';

            const size = new Blob([files[fileName]]).size;
            const sizeKB = (size / 1024).toFixed(2);

            fileItem.innerHTML = `
                <i class="fab ${icon}"></i>
                <span class="file-name">${fileName}</span>
                <span class="file-size">${sizeKB} KB</span>
                <button onclick="deleteFile('${fileName}')" class="btn-delete-file">
                    <i class="fas fa-trash"></i>
                </button>
            `;

            fileItem.onclick = (e) => {
                if (!e.target.closest('.btn-delete-file')) {
                    switchTab('code');
                    switchEditorTab(fileName);
                }
            };

            tree.appendChild(fileItem);
        });
    }

    function uploadFiles() {
        const input = document.createElement('input');
        input.type = 'file';
        input.multiple = true;
        input.accept = '.html,.css,.js,.txt';
        input.onchange = importFiles;
        input.click();
    }

    function importFiles(event) {
        const fileList = event.target.files;
        let imported = 0;

        Array.from(fileList).forEach(file => {
            const reader = new FileReader();
            
            reader.onload = (e) => {
                files[file.name] = e.target.result;
                imported++;

                if (imported === fileList.length) {
                    renderFilesTree();
                    showToast(`${imported} file(s) imported`, 'success');
                }
            };

            reader.readAsText(file);
        });
    }

    function createFolder() {
        showToast('Folder feature coming soon', 'info');
    }

    function deleteFile(fileName) {
        if (!confirm(`Delete ${fileName}?`)) return;

        delete files[fileName];
        
        const tab = document.querySelector(`[data-file="${fileName}"]`);
        if (tab && !tab.classList.contains('editor-tab')) {
            tab.remove();
        }

        if (currentFile === fileName) {
            switchEditorTab('index.html');
        }

        renderFilesTree();
        showToast(`${fileName} deleted`, 'success');
    }

    function deleteSelected() {
        deleteFile(currentFile);
    }

    function downloadAllFiles() {
        Object.keys(files).forEach(fileName => {
            const blob = new Blob([files[fileName]], { type: 'text/plain' });
            downloadFile(blob, fileName);
        });
        
        showToast('All files downloaded', 'success');
    }

    function downloadFile(blob, fileName) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        a.click();
        URL.revokeObjectURL(url);
    }

    // ============================================
    // PROJECT MANAGEMENT
    // ============================================
    function createNewProject() {
        const name = prompt('Project name:');
        if (!name) return;

        const project = {
            id: Date.now().toString(),
            name: name,
            files: { ...files },
            createdAt: new Date().toISOString()
        };

        projects.push(project);
        saveProjects();
        renderProjects();
        
        showToast(`Project "${name}" created`, 'success');
    }

    function loadProjects() {
        const saved = localStorage.getItem('aibuilder_projects');
        if (saved) {
            projects = JSON.parse(saved);
            renderProjects();
        }
    }

    function saveProjects() {
        localStorage.setItem('aibuilder_projects', JSON.stringify(projects));
    }

    function renderProjects() {
        const container = document.getElementById('projectsList');
        container.innerHTML = '';

        if (projects.length === 0) {
            container.innerHTML = '<p class="no-projects">No projects yet</p>';
            return;
        }

        projects.forEach(project => {
            const item = document.createElement('div');
            item.className = 'project-item';
            item.innerHTML = `
                <i class="fas fa-folder"></i>
                <span>${project.name}</span>
                <button onclick="deleteProject('${project.id}')" class="btn-delete-project">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            item.onclick = (e) => {
                if (!e.target.closest('.btn-delete-project')) {
                    loadProject(project);
                }
            };

            container.appendChild(item);
        });
    }

    function loadProject(project) {
        files = { ...project.files };
        currentProject = project;
        codeEditor.setValue(files[currentFile]);
        updatePreview();
        renderFilesTree();
        
        showToast(`Project "${project.name}" loaded`, 'success');
    }

    function deleteProject(projectId) {
        if (!confirm('Delete this project?')) return;

        projects = projects.filter(p => p.id !== projectId);
        saveProjects();
        renderProjects();
        
        showToast('Project deleted', 'success');
    }

    function exportProject() {
        const projectData = {
            name: currentProject?.name || 'Untitled',
            files: files,
            conversation: aiEngine.conversationHistory,
            exportedAt: new Date().toISOString()
        };

        const blob = new Blob([JSON.stringify(projectData, null, 2)], { type: 'application/json' });
        downloadFile(blob, 'project-export.json');
        
        showToast('Project exported', 'success');
    }

    function shareProject() {
        const data = btoa(JSON.stringify({ files }));
        const url = `${window.location.origin}${window.location.pathname}?share=${data}`;
        
        navigator.clipboard.writeText(url).then(() => {
            showToast('Share link copied to clipboard!', 'success');
        });
    }

    // ============================================
    // AI ASSISTANT PANEL
    // ============================================
    async function improveCode() {
        const code = codeEditor.getValue();
        if (!code) {
            showToast('No code to improve', 'warning');
            return;
        }

        const prompt = `Improve this ${currentFile} code:\n\n${code}\n\nMake it better, more efficient, and add best practices.`;
        document.getElementById('chatInput').value = prompt;
        sendMessage();
    }

    async function explainCode() {
        const code = codeEditor.getValue();
        if (!code) {
            showToast('No code to explain', 'warning');
            return;
        }

        const prompt = `Explain this ${currentFile} code in detail:\n\n${code}`;
        document.getElementById('chatInput').value = prompt;
        sendMessage();
    }

    async function debugCode() {
        const code = codeEditor.getValue();
        if (!code) {
            showToast('No code to debug', 'warning');
            return;
        }

        const prompt = `Debug this ${currentFile} code and fix any errors:\n\n${code}`;
        document.getElementById('chatInput').value = prompt;
        sendMessage();
    }

    async function optimizeCode() {
        const code = codeEditor.getValue();
        if (!code) {
            showToast('No code to optimize', 'warning');
            return;
        }

        const prompt = `Optimize this ${currentFile} code for performance:\n\n${code}`;
        document.getElementById('chatInput').value = prompt;
        sendMessage();
    }

    async function addFeature() {
        const feature = prompt('What feature do you want to add?');
        if (!feature) return;

        const prompt = `Add ${feature} to this website. Current code:\n\nHTML:\n${files['index.html']}\n\nCSS:\n${files['styles.css']}\n\nJS:\n${files['script.js']}`;
        document.getElementById('chatInput').value = prompt;
        sendMessage();
    }

    function applySuggestion(suggestion) {
        document.getElementById('chatInput').value = suggestion;
        showToast('Suggestion applied', 'info');
    }

    function toggleAIPanel() {
        const panel = document.querySelector('.ai-panel');
        panel.classList.toggle('collapsed');
    }

    function updateCurrentModelInfo() {
        const modelName = CONFIG.MODELS[aiEngine.currentModel].name;
        document.getElementById('currentModelInfo').textContent = modelName;
    }

    // ============================================
    // SETTINGS
    // ============================================
    function changeEditorTheme(theme) {
        codeEditor.setOption('theme', theme);
        CONFIG.SETTINGS.editorTheme = theme;
        saveSettings();
    }

    function changeFontSize(size) {
        codeEditor.getWrapperElement().style.fontSize = size + 'px';
        CONFIG.SETTINGS.fontSize = size;
        saveSettings();
    }

    function toggleAutoSave(enabled) {
        CONFIG.SETTINGS.autoSave = enabled;
        
        if (enabled) {
            startAutoSave();
        } else {
            stopAutoSave();
        }
        
        saveSettings();
    }

    function toggleLivePreview(enabled) {
        CONFIG.SETTINGS.livePreview = enabled;
        saveSettings();
    }

    function updateTemperature(value) {
        aiEngine.temperature = parseFloat(value);
        document.getElementById('tempValue').textContent = value;
        CONFIG.SETTINGS.temperature = parseFloat(value);
        saveSettings();
    }

    function saveSettings() {
        localStorage.setItem('aibuilder_settings', JSON.stringify(CONFIG.SETTINGS));
    }

    function loadSettings() {
        const saved = localStorage.getItem('aibuilder_settings');
        if (saved) {
            Object.assign(CONFIG.SETTINGS, JSON.parse(saved));
        }
    }

    function clearAllData() {
        if (!confirm('This will delete ALL data including projects, files, and chat history. Are you sure?')) return;

        localStorage.clear();
        sessionStorage.clear();
        location.reload();
    }

    function exportAllData() {
        const allData = {
            projects: projects,
            files: files,
            settings: CONFIG.SETTINGS,
            conversation: aiEngine.conversationHistory,
            exportedAt: new Date().toISOString()
        };

        const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
        downloadFile(blob, 'aibuilder-backup.json');
        
        showToast('All data exported', 'success');
    }

    function importData() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        
        input.onchange = (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            
            reader.onload = (event) => {
                try {
                    const data = JSON.parse(event.target.result);
                    
                    if (data.projects) projects = data.projects;
                    if (data.files) files = data.files;
                    if (data.settings) Object.assign(CONFIG.SETTINGS, data.settings);
                    if (data.conversation) aiEngine.conversationHistory = data.conversation;

                    saveProjects();
                    saveSession();
                    saveSettings();
                    
                    location.reload();
                } catch (error) {
                    showToast('Invalid backup file', 'error');
                }
            };
            
            reader.readAsText(file);
        };
        
        input.click();
    }

    // ============================================
    // SESSION MANAGEMENT
    // ============================================
    function saveSession() {
        const sessionData = {
            files: files,
            currentFile: currentFile,
            currentProject: currentProject,
            conversation: aiEngine.conversationHistory,
            timestamp: Date.now()
        };

        sessionStorage.setItem('aibuilder_session', JSON.stringify(sessionData));
    }

    function loadSession() {
        const saved = sessionStorage.getItem('aibuilder_session');
        
        if (saved) {
            try {
                const data = JSON.parse(saved);
                
                if (data.files) files = data.files;
                if (data.currentFile) currentFile = data.currentFile;
                if (data.currentProject) currentProject = data.currentProject;
                if (data.conversation) aiEngine.conversationHistory = data.conversation;
                
                console.log('Session restored');
            } catch (error) {
                console.error('Session load error:', error);
            }
        }
        
        loadSettings();
    }

    function startAutoSave() {
        stopAutoSave();
        
        autoSaveInterval = setInterval(() => {
            saveSession();
            updateStorageInfo();
        }, CONFIG.SETTINGS.saveInterval);
    }

    function stopAutoSave() {
        if (autoSaveInterval) {
            clearInterval(autoSaveInterval);
            autoSaveInterval = null;
        }
    }

    function resetSession() {
        if (!confirm('Reset all session data? This will clear current work but keep saved projects.')) return;

        files = {
            'index.html': '',
            'styles.css': '',
            'script.js': ''
        };
        
        aiEngine.resetConversation();
        sessionStorage.clear();
        
        codeEditor.setValue('');
        updatePreview();
        
        document.getElementById('chatMessages').innerHTML = '<div class="welcome-message"><h2>Session reset</h2></div>';
        
        showToast('Session reset', 'info');
    }

    function updateStorageInfo() {
        const data = JSON.stringify({ files, projects });
        const size = new Blob([data]).size;
        const sizeKB = (size / 1024).toFixed(2);
        
        document.getElementById('storageUsed').textContent = sizeKB + ' KB';
    }

    function updateMessageCount() {
        document.getElementById('messageCount').textContent = aiEngine.messageCount;
    }

    function startSessionTimer() {
        setInterval(() => {
            const elapsed = Date.now() - sessionStartTime;
            const hours = Math.floor(elapsed / 3600000);
            const minutes = Math.floor((elapsed % 3600000) / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            
            let timeString = '';
            if (hours > 0) timeString += hours + ':';
            timeString += minutes.toString().padStart(2, '0') + ':';
            timeString += seconds.toString().padStart(2, '0');
            
            document.getElementById('sessionTime').textContent = timeString;
        }, 1000);
    }

    // ============================================
    // UI HELPERS
    // ============================================
    function showLoading(mainText, subText = '') {
        const overlay = document.getElementById('loadingOverlay');
        document.getElementById('loadingText').textContent = mainText;
        document.getElementById('loadingSubtext').textContent = subText;
        overlay.classList.add('active');
        
        document.getElementById('aiStatus').textContent = 'Processing...';
        document.getElementById('aiStatus').className = 'status-processing';
        
        animateProgress();
    }

    function hideLoading() {
        document.getElementById('loadingOverlay').classList.remove('active');
        document.getElementById('aiStatus').textContent = 'Ready';
        document.getElementById('aiStatus').className = 'status-ready';
    }

    function animateProgress() {
        const progressBar = document.getElementById('progressBar');
        let width = 0;
        
        const interval = setInterval(() => {
            if (width >= 90) {
                clearInterval(interval);
            } else {
                width += Math.random() * 10;
                progressBar.style.width = Math.min(width, 90) + '%';
            }
        }, 500);
    }

    function showToast(message, type = 'info') {
        const container = document.getElementById('toastContainer');
        
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        
        const icon = {
            success: 'fa-check-circle',
            error: 'fa-exclamation-circle',
            warning: 'fa-exclamation-triangle',
            info: 'fa-info-circle'
        }[type] || 'fa-info-circle';
        
        toast.innerHTML = `
            <i class="fas ${icon}"></i>
            <span>${message}</span>
        `;
        
        container.appendChild(toast);
        
        setTimeout(() => toast.classList.add('show'), 10);
        
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    // ============================================
    // UTILITY FUNCTIONS
    // ============================================
    function attachReference() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*,.html,.css,.js';
        input.onchange = (e) => {
            const file = e.target.files[0];
            showToast(`Reference file ${file.name} attached`, 'info');
        };
        input.click();
    }

    function startVoiceInput() {
        if (!('webkitSpeechRecognition' in window)) {
            showToast('Voice input not supported', 'error');
            return;
        }

        const recognition = new webkitSpeechRecognition();
        recognition.lang = 'my-MM';
        recognition.start();

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            document.getElementById('chatInput').value = transcript;
            showToast('Voice captured', 'success');
        };

        recognition.onerror = () => {
            showToast('Voice input error', 'error');
        };
    }

    // Check for shared project in URL
    const urlParams = new URLSearchParams(window.location.search);
    const sharedData = urlParams.get('share');
    if (sharedData) {
        try {
            const decoded = JSON.parse(atob(sharedData));
            files = decoded.files;
            codeEditor.setValue(files[currentFile]);
            updatePreview();
            showToast('Shared project loaded', 'success');
        } catch (error) {
            console.error('Failed to load shared project:', error);
        }
    }
    </script>
</body>
</html>
